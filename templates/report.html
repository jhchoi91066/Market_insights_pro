{% extends "base.html" %}

{% block title %}Analysis Result: {{ report.keyword }}{% endblock %}

{% block content %}
<div class="animate-fade-in">
    <!-- Header Section -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Market Analysis</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400">Keyword: <span class="font-semibold text-primary-600 dark:text-primary-400">
                '{{ report.keyword }}'</span></p>
        </div>
        <div class="mt-4 sm:mt-0">
            <a href="/" class="btn btn-secondary">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                Analyze Another
            </a>
        </div>
    </div>

    <!-- Interactive Filters -->
    <div class="card mb-6">
        <div class="card-body">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                <div>
                    <label for="price-slider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Price Range Filter</label>
                    <div id="price-slider" class="mt-4"></div>
                    <div id="price-slider-values" class="text-sm text-gray-500 dark:text-gray-400 mt-2 text-center"></div>
                </div>
                <div id="filtered-stats" class="text-center md:text-left">
                    <p class="text-gray-600 dark:text-gray-400">Showing <strong id="filtered-product-count" class="text-primary-600 dark:text-primary-400"></strong> products</p>
                </div>
            </div>
        </div>
    </div>

    <div id="report-container" class="space-y-8">
        <!-- Key Metrics Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Market Entry Barrier Score -->
            <div class="stat-card text-center col-span-1 lg:col-span-2">
                <div class="mb-4">
                    <div class="stat-label">Market Entry Barrier Score</div>
                    <div class="stat-value text-4xl lg:text-5xl {{ 'text-danger-600' if report.difficulty_score >= 7 else ('text-warning-600' if report.difficulty_score >= 4 else 'text-success-600') }}">
                        {{ report.difficulty_score }}<span class="text-2xl text-gray-500">/10</span>
                    </div>
                </div>
                <div class="progress mb-3">
                    <div class="progress-bar {{ 'danger' if report.difficulty_score >= 7 else ('warning' if report.difficulty_score >= 4 else 'success') }}" 
                         style="width: {{ report.difficulty_score * 10 }}%"></div>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400">Higher scores indicate fiercer competition</p>
            </div>

            <!-- Competition Count -->
            <div class="stat-card">
                <div class="stat-label">Competing Products</div>
                <div class="stat-value text-primary-600">{{ report.competitor_count }}</div>
                {% if report.prime_count %}
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-2">
                    <span class="badge badge-primary">{{ report.prime_count }} Prime ({{ report.prime_percentage }}%)</span>
                </div>
                {% endif %}
            </div>

            <!-- Market Saturation -->
            <div class="stat-card">
                <div class="stat-label">Market Saturation</div>
                <div class="stat-value text-secondary-600">{{ report.market_saturation_percentage }}%</div>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Top 10 market share</p>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="card">
                <div class="card-header"><h3 class="card-title">Competition Overview</h3></div>
                <div class="card-body"><canvas id="competitionChart" width="400" height="300"></canvas></div>
            </div>
            <div class="card">
                <div class="card-header"><h3 class="card-title">Top 5 Products by Sales</h3></div>
                <div class="card-body"><canvas id="marketShareChart" width="400" height="300"></canvas></div>
            </div>
        </div>

        <!-- Top Products Table -->
        <div class="card">
            <div class="card-header flex flex-col sm:flex-row sm:items-center sm:justify-between">
                <div>
                    <h3 class="card-title">Top 10 Products by Sales Volume</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Monthly purchase estimates</p>
                </div>
                <div class="mt-4 sm:mt-0">
                    <label for="sort-select" class="sr-only">Sort by</label>
                    <select id="sort-select" class="input-field !py-2 !px-3 !pr-8">
                        <option value="purchased_last_month">Sort by Sales Volume</option>
                        <option value="product_rating">Sort by Rating</option>
                        <option value="numeric_price_desc">Sort by Price (High to Low)</option>
                        <option value="numeric_price_asc">Sort by Price (Low to High)</option>
                    </select>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="overflow-x-auto">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Rank</th><th>Product</th><th>Price</th><th>Rating</th><th>Monthly Sales</th><th>Prime</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <!-- Rows will be dynamically inserted by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="no-products-message" class="hidden p-8 text-center text-gray-500">
                    <p>No products match the selected price range.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/report.js"></script>
{% endblock %}
